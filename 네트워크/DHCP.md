# DHCP(Dynamic Host Configuration Protocol)

## DHCP란?
DHCP는 IP주소를 포함한 네트워크 정보를 자동으로 할당하는 프로토콜입니다.
새로운 장치가 네트워크에 접속하면 DHCP 서버가 사용 가능한 IP 주소 중 하나를 할당하고, 
서브넷 마스크, 게이트웨이, DNS 서버 주소 등과 같은 추가 정보를 제공합니다. 

### 특징
- 브로트캐스트를 사용합니다.
  - 브로드캐스트(Broadcast)는 네트워크에서 한 호스트가 네트워크 상의 모든 호스트에게 데이터를 전송하는 방식입니다.
  - DHCP 클라이언트는 초기에 네트워크에 연결할 때 DHCP 서버를 찾기 위해 MAC 주소로 브로드캐스트 메시지를 사용합니다.
  - 브로드캐스트 메시지는 네트워크 상의 모든 호스트에게 전송되므로, DHCP 서버는 이를 수신하여 해당 클라이언트에게 응답합니다.
- UDP 통신을 기반으로 합니다.
  - UDP(User Datagram Protocol)는 인터넷 프로토콜 스위트에서 IP와 함께 사용되는 전송 계층 프로토콜입니다.
  - UDP는 비연결형 프로토콜로 가볍고 빠른 전송을 지향합니다. 
  - DHCP는 UDP를 사용하여 클라이언트와 서버 간에 메시지를 교환합니다.
- DHCP Server가 응답합니다.
  - DHCP Client가 요청하면 DHCP Server가 응답합니다.

### 장점
- IP주소 및 기타 구성 정보를 사용자가 직접 입력하지 않아도 됩니다.
- IP 주소의 충돌을 방지합니다.
- Pv4의 주소 부족을 어느 정도 해결합니다.

### 단점
- 네트워크 정보 할당을 DHCP 서버에 의존하기 때문에 DHCP 서버에 문제가 생길 경우 통신이 어렵습니다.


### DHCP 동작 과정
1. DHCP Discovoer(Client)
   - 아직 인터넷에 접속하지 못한 호스트는 DHCP 서버가 어디있는지 알 수 없습니다.
   - 그래서 호스트가 속한 서브넷에 브로드캐스팅을 합니다.
   - 브로드캐스팅은 IP 주소를 할당받지 못했기 때문에 MAC 주소로 합니다.
2. DHCP Offer(Server)
   - DHCP 서버가 클라이언트로부터 DHCP Discover 메시지를 수신하면 클라이언트 IP 주소가 아직 할당되지 않았기 때문에 이더넷 네트워크를 통해 DHCP 제안 메시지를 브로드캐스트하여 클라이언트에게 사용 가능함을 알립니다.
   - 이 메시지에는 클라이언트 IP 주소, 서브넷 마스크, 기본 게이트웨이 IP 주소, DNS IP 주소, IP 임대 시간 및 DHCP 서버 IP 주소와 같은 네트워크 정보가 포함됩니다.
   - 브로드캐스트된 DHCP Offer 메시지는 DHCP Discover 메시지를 보낸 클라이언트를 포함하여 동일한 서브넷 네트워크에 있는 모든 클라이언트에게 전달됩니다.
3. DHCP Request(Client)
   - 클라이언트는 동일한 서브넷에 사용 가능한 DHCP 서버가 있음을 인식합니다.
   - 그런 다음 이더넷 네트워크를 통해 서버에 DHCP 요청 메시지를 브로드캐스트하여 자신의 IP 주소를 포함한 네트워크 구성 데이터를 요청합니다.
   - 동일한 서브넷에서 하나 이상의 DHCP 서버가 응답하여 클라이언트가 여러 DHCP 제안 메시지를 받으면 **DHCP 서버 중 하나를 선택**하고 선택한 DHCP 서버의 IP 주소를 DHCP Server Identifier 필드에 입력합니다.
   - 그런 다음 DHCP 요청 메시지를 브로드캐스팅하여 서브넷 네트워크의 모든 DHCP 서버에 선택한 DHCP 서버와 자신의 정보를 알립니다.
   - 일반적으로 모든 DHCP 서버는 DHCP Offer 메시지를 보낼 때 네트워크 구성 데이터(즉, 클라이언트의 IP 주소 및 기타 정보)를 내부적으로 저장합니다.
4. DHCP ACK(Server)
   - 클라이언트로부터 DHCP Request를 받은 서버는 DHCP Server Identifier 필드에 표시된 IP 주소가 자신의 IP 주소와 일치하는지 확인합니다.
   - 일치하면 클라이언트가 메시지를 수신할 수 있도록 DHCP Ack 메시지를 브로드캐스트합니다.
   - 브로트캐스트로 보내는 이유는 클라이언트는 아직 IP 주소를 할당받지 않았기 때문입니다.
   - 이때 DHCP 서버는 클라이언트 IP 주소를 포함한 모든 네트워크 구성 데이터(DHCP Offer 메시지와 동일한)를 클라이언트에게 전달한다.
   - 그런 다음 클라이언트는 전송된 데이터를 사용하여 네트워크 인터페이스를 구성하고 최종적으로 인터넷에 연결합니다. 
     - IP 주소
     - 서브넷 마스크
     - 기본 게이트웨이 IP 주소
     - DNS 서버 IP 주소
     - 임대 시간(클라이언트가 DHCP 서버에서 할당/임대한 IP 주소를 사용할 수 있는 시간)

   
[동작 과정 참조](https://www.netmanias.com/en/post/techdocs/5998/dhcp-network-protocol/understanding-the-basic-operations-of-dhcp)
